---
import ToolLayout from "@/layouts/ToolLayout/ToolLayout.astro";
import { friendsService } from '@/lib/supabase';
import friends_data from "@/page_data/Friends";

// è·å–Supabaseæ•°æ®ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨é™æ€æ•°æ®ä½œä¸ºåå¤‡
let friendsItems = [];
try {
  // å°è¯•ä»Supabaseè·å–æ•°æ®
  if (typeof friendsService !== 'undefined') {
    const data = await friendsService.getAllFriends();
    if (data && data.length > 0) {
      friendsItems = data;
    }
  }
} catch (error) {
  console.error('ä»æ•°æ®åº“è·å–æœ‹å‹åœˆå†…å®¹å¤±è´¥:', error);
}

// å¦‚æœSupabaseè·å–å¤±è´¥ï¼Œä½¿ç”¨é™æ€æ•°æ®
if (friendsItems.length === 0) {
  friendsItems = friends_data.api ? await fetch(friends_data.api).then(res => res.json()).catch(() => friends_data.data) : friends_data.data;
}

// æŒ‰æ—¥æœŸé™åºæ’åº
friendsItems.sort((a, b) => new Date(b.date) - new Date(a.date));
---

<ToolLayout 
	title="æœ‹å‹çš„æ–°åŠ¨æ€"
	h1="æœ‹å‹åœˆ ğŸ´"
	desc="è¿™é‡Œå±•ç¤ºæœ‹å‹ä»¬çš„æœ€æ–°åŠ¨æ€"
	type="friends"
>
    <div class="friends-info">
        <div class="h-info-text">
            <p>è¿™é‡Œå°†æ˜¾ç¤ºæ‚¨æ·»åŠ çš„æœ‹å‹çš„åšå®¢æ–‡ç« åŠ¨æ€</p>
            <p>æ·»åŠ æœ‹å‹åŠ¨æ€è¯·ä½¿ç”¨ç®¡ç†é¢æ¿</p>
        </div>
    </div>
    <div class="friends-lists">
        {
            friendsItems.map(Item => (
                <div class="friends-item">
                    <div class="friends-item-header">
                        <div class="friends-item-title">
                            <a href={Item.link} target="_blank">{Item.title}</a>
                        </div>
                        <div class="friends-item-info">
                            <span>{Item.auther}</span>
                            <span>{new Date(Item.date).toLocaleDateString('zh-CN')}</span>
                        </div>
                    </div>
                    <div class="friends-item-content">{Item.content}</div>
                    <div class="friends-item-footer">
                        <a href={Item.link} target="_blank" class="friends-item-link">æŸ¥çœ‹åŸæ–‡</a>
                    </div>
                </div>
            ))
        }
    </div>
</ToolLayout>

<style lang="less">
.friends-info {
    margin-bottom: 30px;
    border-radius: var(--vh-main-radius);
    overflow: hidden;
    padding: 38.8px;
    background-color: #6a11cb;
    background-image: linear-gradient(to right, #8e2de2 0%, #4a00e0 100%);
    color: #fff;
    position: relative;
    .h-info-text {
        max-width: 388px;
    }
    p {
        letter-spacing: 0.3px;
        margin: 0;
    }
}
.friends-item {
    padding: 2rem;
    border-radius: var(--vh-main-radius);
    background-color: #fff;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
    &-header {
        margin-bottom: 1rem;
    }
    &-title {
        margin-bottom: 0.5rem;
        a {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            &:hover {
                color: var(--vh-main-color);
            }
        }
    }
    &-info {
        font-size: 0.9rem;
        color: #666;
        span {
            margin-right: 1rem;
            &:last-child {
                margin-right: 0;
            }
        }
    }
    &-content {
        line-height: 1.7;
        margin-bottom: 1.5rem;
        color: #666;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    &-footer {
        text-align: right;
    }
    &-link {
        display: inline-block;
        padding: 0.5rem 1rem;
        background-color: var(--vh-main-color);
        color: #fff;
        text-decoration: none;
        border-radius: 0.25rem;
        transition: background-color 0.3s;
        &:hover {
            background-color: darken(#01C4B6, 5%);
        }
    }
}
</style> 